# 199|OS Customer Success MCP Server - STAGING Environment
# Production-like environment for testing deployments

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

SERVER_NAME=199OS-CustomerSuccess-STAGING
SERVER_PORT=8080

# Logging Configuration - Info level with structured logs
LOG_LEVEL=INFO
LOG_FORMAT=json

# Database Configuration - Staging PostgreSQL with TLS
DATABASE_URL=postgresql://cs_staging:CHANGE_ME@staging-db.internal:5432/cs_mcp_staging
DB_POOL_SIZE=50
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_SSL_MODE=require  # TLS required for staging

# Redis Configuration - Staging Redis with password
REDIS_URL=redis://staging-redis.internal:6379/0
REDIS_PASSWORD=CHANGE_ME_staging_redis_password
REDIS_MAX_CONNECTIONS=50
CACHE_DEFAULT_TTL=1800    # 30 minutes
CACHE_LONG_TTL=21600      # 6 hours

# Rate Limiting - Production-like limits
MAX_REQUESTS_PER_MINUTE=2000
MAX_REQUESTS_PER_HOUR=20000
RATE_LIMIT_PER_CLIENT_PER_MINUTE=150

# ============================================================================
# SECURITY CONFIGURATION - Generate unique staging keys
# ============================================================================

# IMPORTANT: Generate unique keys for staging
# openssl rand -base64 32
MASTER_PASSWORD=CHANGE_ME_staging_master_password

# openssl rand -hex 32
ENCRYPTION_KEY=CHANGE_ME_generate_with_openssl_rand_hex_32

# openssl rand -base64 64
JWT_SECRET=CHANGE_ME_generate_with_openssl_rand_base64_64

MCP_API_KEY=CHANGE_ME_staging_api_key
WEBHOOK_SECRET=CHANGE_ME_staging_webhook_secret

# ============================================================================
# LEARNING SYSTEM CONFIGURATION
# ============================================================================

LEARNING_COMPLETION_THRESHOLD=0.70
LEARNING_FREQUENCY=often
PREFERENCES_DIR=./config/preferences

# ============================================================================
# PLATFORM INTEGRATIONS - Use test/sandbox accounts
# ============================================================================

# Zendesk (use sandbox or test account)
ZENDESK_SUBDOMAIN=staging-subdomain
ZENDESK_EMAIL=staging@yourcompany.com
ZENDESK_API_TOKEN=CHANGE_ME_zendesk_staging_token

# Intercom (use test workspace)
INTERCOM_ACCESS_TOKEN=CHANGE_ME_intercom_staging_token
INTERCOM_APP_ID=staging_app_id

# Mixpanel (use staging project)
MIXPANEL_PROJECT_TOKEN=CHANGE_ME_mixpanel_staging_token
MIXPANEL_API_SECRET=CHANGE_ME_mixpanel_staging_secret

# Gainsight (use sandbox)
GAINSIGHT_API_KEY=CHANGE_ME_gainsight_staging_key
GAINSIGHT_BASE_URL=https://staging-instance.gainsightcloud.com

# Amplitude (use staging project)
AMPLITUDE_API_KEY=CHANGE_ME_amplitude_staging_key
AMPLITUDE_SECRET_KEY=CHANGE_ME_amplitude_staging_secret

# SendGrid (use test account or separate sending domain)
SENDGRID_API_KEY=CHANGE_ME_sendgrid_staging_key
SENDGRID_FROM_EMAIL=staging@yourcompany.com
SENDGRID_FROM_NAME=YourCompany Staging
SENDGRID_MAX_RETRIES=2
SENDGRID_RETRY_DELAY=1
SENDGRID_BATCH_SIZE=500

# Segment (use staging source)
SEGMENT_WRITE_KEY=CHANGE_ME_segment_staging_key

# Salesforce (use sandbox)
SALESFORCE_USERNAME=staging@yourcompany.com.staging
SALESFORCE_PASSWORD=CHANGE_ME_salesforce_staging_password
SALESFORCE_SECURITY_TOKEN=CHANGE_ME_salesforce_staging_token

# HubSpot (use test account)
HUBSPOT_ACCESS_TOKEN=CHANGE_ME_hubspot_staging_token

# Slack (use staging workspace)
SLACK_BOT_TOKEN=xoxb-CHANGE_ME_slack_staging_token
SLACK_SIGNING_SECRET=CHANGE_ME_slack_staging_secret

# Typeform (use test account)
TYPEFORM_ACCESS_TOKEN=CHANGE_ME_typeform_staging_token

# Freshdesk (use sandbox)
FRESHDESK_API_KEY=CHANGE_ME_freshdesk_staging_key
FRESHDESK_DOMAIN=staging-subdomain.freshdesk.com

# ============================================================================
# MCP SERVER INTEGRATIONS - Enable for staging testing
# ============================================================================

MCP_ENABLE_ZENDESK=true
MCP_ENABLE_INTERCOM=true
MCP_ENABLE_MIXPANEL=true
MCP_ENABLE_SALESFORCE=true
MCP_ENABLE_HUBSPOT=true
MCP_ENABLE_SENDGRID=true
MCP_ENABLE_SLACK=true

MCP_CONFIG_PATH=./config/mcp_servers.json

# ============================================================================
# HEALTH SCORE CONFIGURATION
# ============================================================================

HEALTH_SCORE_WEIGHT_USAGE=0.35
HEALTH_SCORE_WEIGHT_ENGAGEMENT=0.25
HEALTH_SCORE_WEIGHT_SUPPORT=0.15
HEALTH_SCORE_WEIGHT_SATISFACTION=0.15
HEALTH_SCORE_WEIGHT_PAYMENT=0.10

HEALTH_SCORE_AT_RISK_THRESHOLD=50
HEALTH_SCORE_HEALTHY_THRESHOLD=75
HEALTH_SCORE_CHAMPION_THRESHOLD=90

CHURN_PROBABILITY_HIGH_RISK=0.70
CHURN_PROBABILITY_MEDIUM_RISK=0.40
CHURN_PROBABILITY_LOW_RISK=0.15

# ============================================================================
# ONBOARDING CONFIGURATION
# ============================================================================

TIME_TO_VALUE_TARGET=30
TIME_TO_FIRST_VALUE=7
TIME_TO_ACTIVATION=14

ONBOARDING_COMPLETION_THRESHOLD=0.80
TRAINING_COMPLETION_THRESHOLD=0.75

# ============================================================================
# RETENTION CONFIGURATION
# ============================================================================

RETENTION_CAMPAIGN_TRIGGER_SCORE=60
RETENTION_CAMPAIGN_FREQUENCY_DAYS=7
RETENTION_ESCALATION_SCORE=40

RENEWAL_REMINDER_DAYS_BEFORE=90,60,30,14,7
RENEWAL_FORECAST_WINDOW_DAYS=90

# ============================================================================
# EXPANSION CONFIGURATION
# ============================================================================

EXPANSION_MIN_HEALTH_SCORE=75
EXPANSION_MIN_USAGE_THRESHOLD=0.70
EXPANSION_MIN_TENURE_DAYS=60

UPSELL_OPPORTUNITY_THRESHOLD=0.65
CROSS_SELL_OPPORTUNITY_THRESHOLD=0.60

# ============================================================================
# SUPPORT CONFIGURATION
# ============================================================================

SUPPORT_FIRST_RESPONSE_SLA=15
SUPPORT_RESOLUTION_SLA_P1=240
SUPPORT_RESOLUTION_SLA_P2=480
SUPPORT_RESOLUTION_SLA_P3=1440

SUPPORT_ESCALATION_NO_RESPONSE_HOURS=2
SUPPORT_ESCALATION_NO_RESOLUTION_DAYS=3

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

ENABLE_MONITORING=true
ENABLE_AUDIT_LOGGING=true
ENABLE_TRACING=true

AUDIT_LOG_RETENTION_DAYS=30  # 30 days for staging
AUDIT_LOG_DIR=./config/audit_logs

# Sentry (optional - use test DSN)
# SENTRY_DSN=https://staging-dsn@sentry.io/project

# DataDog (optional - use staging API key)
# DATADOG_API_KEY=CHANGE_ME_datadog_staging_key

# ============================================================================
# FEATURE FLAGS - Match production configuration
# ============================================================================

FEATURE_CHURN_PREDICTION=true
FEATURE_HEALTH_SCORING=true
FEATURE_AUTOMATED_RETENTION=true
FEATURE_EXPANSION_SCORING=true
FEATURE_SENTIMENT_ANALYSIS=true
FEATURE_AUTO_TICKET_ROUTING=true
FEATURE_KNOWLEDGE_BASE_SYNC=true
FEATURE_EBR_AUTOMATION=true
