# 199|OS Customer Success MCP Server - PRODUCTION Environment
# Production-hardened configuration - MAXIMUM SECURITY

# WARNING: Never commit this file with real credentials to version control
# Store actual credentials in AWS Secrets Manager or equivalent

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================

SERVER_NAME=199OS-CustomerSuccess-PROD
SERVER_PORT=8080

# Logging Configuration - Structured JSON for production monitoring
LOG_LEVEL=INFO  # Use INFO for production (DEBUG only for troubleshooting)
LOG_FORMAT=json

# Database Configuration - Production PostgreSQL with TLS and connection pooling
DATABASE_URL=postgresql://cs_prod:CHANGE_ME@prod-db.internal:5432/cs_mcp_production
DB_POOL_SIZE=100          # INCREASED from 10 to 100 for production load
DB_MAX_OVERFLOW=50        # Increased overflow capacity
DB_POOL_TIMEOUT=30
DB_SSL_MODE=require       # TLS REQUIRED for production
DB_POOL_PRE_PING=true     # Health check connections
DB_POOL_RECYCLE=3600      # Recycle connections every hour

# Redis Configuration - Production Redis with password and TLS
REDIS_URL=redis://prod-redis.internal:6379/0
REDIS_PASSWORD=CHANGE_ME_production_redis_password_min_32_chars
REDIS_MAX_CONNECTIONS=100  # Increased for production load
REDIS_SSL=true             # TLS for Redis connections
CACHE_DEFAULT_TTL=3600     # 1 hour
CACHE_LONG_TTL=86400       # 24 hours

# Rate Limiting - Strict production limits to prevent abuse
MAX_REQUESTS_PER_MINUTE=1000
MAX_REQUESTS_PER_HOUR=10000
RATE_LIMIT_PER_CLIENT_PER_MINUTE=100
RATE_LIMIT_ENABLED=true

# ============================================================================
# SECURITY CONFIGURATION - CRITICAL: Generate strong unique keys
# ============================================================================

# Master password for credential encryption (min 32 characters)
# Generate with: openssl rand -base64 48
MASTER_PASSWORD=CHANGE_ME_use_openssl_rand_base64_48_min_32_chars

# Encryption key for AES-256 (64 hex characters = 256 bits)
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=CHANGE_ME_use_openssl_rand_hex_32_exactly_64_chars

# JWT secret for token signing (min 64 characters)
# Generate with: openssl rand -base64 96
JWT_SECRET=CHANGE_ME_use_openssl_rand_base64_96_min_64_chars

# MCP API key for server authentication
# Generate with: openssl rand -hex 32
MCP_API_KEY=CHANGE_ME_use_openssl_rand_hex_32

# Webhook secret for signature validation
# Generate with: openssl rand -hex 32
WEBHOOK_SECRET=CHANGE_ME_use_openssl_rand_hex_32
WEBHOOK_TIMESTAMP_TOLERANCE=300  # 5 minutes

# JWT Configuration
JWT_EXPIRATION_HOURS=24
JWT_REFRESH_EXPIRATION_DAYS=7

# Session Configuration
SESSION_TIMEOUT_MINUTES=30
SESSION_ABSOLUTE_TIMEOUT_HOURS=12

# ============================================================================
# LEARNING SYSTEM CONFIGURATION
# ============================================================================

LEARNING_COMPLETION_THRESHOLD=0.70
LEARNING_FREQUENCY=often
PREFERENCES_DIR=./config/preferences

# ============================================================================
# PLATFORM INTEGRATIONS - Use production credentials
# ============================================================================

# Zendesk (production account)
ZENDESK_SUBDOMAIN=CHANGE_ME_your_production_subdomain
ZENDESK_EMAIL=CHANGE_ME_production@yourcompany.com
ZENDESK_API_TOKEN=CHANGE_ME_zendesk_production_api_token

# Intercom (production workspace)
INTERCOM_ACCESS_TOKEN=CHANGE_ME_intercom_production_token
INTERCOM_APP_ID=CHANGE_ME_production_app_id

# Mixpanel (production project)
MIXPANEL_PROJECT_TOKEN=CHANGE_ME_mixpanel_production_token
MIXPANEL_API_SECRET=CHANGE_ME_mixpanel_production_secret

# Gainsight (production instance)
GAINSIGHT_API_KEY=CHANGE_ME_gainsight_production_key
GAINSIGHT_BASE_URL=https://your-instance.gainsightcloud.com

# Amplitude (production project)
AMPLITUDE_API_KEY=CHANGE_ME_amplitude_production_key
AMPLITUDE_SECRET_KEY=CHANGE_ME_amplitude_production_secret

# SendGrid (production account with verified domain)
SENDGRID_API_KEY=CHANGE_ME_sendgrid_production_key
SENDGRID_FROM_EMAIL=noreply@yourcompany.com
SENDGRID_FROM_NAME=YourCompany Customer Success
SENDGRID_MAX_RETRIES=3
SENDGRID_RETRY_DELAY=2
SENDGRID_BATCH_SIZE=1000

# Segment (production source)
SEGMENT_WRITE_KEY=CHANGE_ME_segment_production_key

# Salesforce (production org)
SALESFORCE_USERNAME=CHANGE_ME_production@yourcompany.com
SALESFORCE_PASSWORD=CHANGE_ME_salesforce_production_password
SALESFORCE_SECURITY_TOKEN=CHANGE_ME_salesforce_production_token

# HubSpot (production account)
HUBSPOT_ACCESS_TOKEN=CHANGE_ME_hubspot_production_token

# Slack (production workspace)
SLACK_BOT_TOKEN=xoxb-CHANGE_ME_slack_production_token
SLACK_SIGNING_SECRET=CHANGE_ME_slack_production_signing_secret

# Typeform (production account)
TYPEFORM_ACCESS_TOKEN=CHANGE_ME_typeform_production_token

# Freshdesk (production account)
FRESHDESK_API_KEY=CHANGE_ME_freshdesk_production_key
FRESHDESK_DOMAIN=yourcompany.freshdesk.com

# ============================================================================
# MCP SERVER INTEGRATIONS - Enable production services
# ============================================================================

MCP_ENABLE_ZENDESK=true
MCP_ENABLE_INTERCOM=true
MCP_ENABLE_MIXPANEL=true
MCP_ENABLE_SALESFORCE=true
MCP_ENABLE_HUBSPOT=true
MCP_ENABLE_SENDGRID=true
MCP_ENABLE_SLACK=true

MCP_CONFIG_PATH=./config/mcp_servers.json

# ============================================================================
# HEALTH SCORE CONFIGURATION
# ============================================================================

HEALTH_SCORE_WEIGHT_USAGE=0.35
HEALTH_SCORE_WEIGHT_ENGAGEMENT=0.25
HEALTH_SCORE_WEIGHT_SUPPORT=0.15
HEALTH_SCORE_WEIGHT_SATISFACTION=0.15
HEALTH_SCORE_WEIGHT_PAYMENT=0.10

HEALTH_SCORE_AT_RISK_THRESHOLD=50
HEALTH_SCORE_HEALTHY_THRESHOLD=75
HEALTH_SCORE_CHAMPION_THRESHOLD=90

CHURN_PROBABILITY_HIGH_RISK=0.70
CHURN_PROBABILITY_MEDIUM_RISK=0.40
CHURN_PROBABILITY_LOW_RISK=0.15

# ============================================================================
# ONBOARDING CONFIGURATION
# ============================================================================

TIME_TO_VALUE_TARGET=30
TIME_TO_FIRST_VALUE=7
TIME_TO_ACTIVATION=14

ONBOARDING_COMPLETION_THRESHOLD=0.80
TRAINING_COMPLETION_THRESHOLD=0.75

# ============================================================================
# RETENTION CONFIGURATION
# ============================================================================

RETENTION_CAMPAIGN_TRIGGER_SCORE=60
RETENTION_CAMPAIGN_FREQUENCY_DAYS=7
RETENTION_ESCALATION_SCORE=40

RENEWAL_REMINDER_DAYS_BEFORE=90,60,30,14,7
RENEWAL_FORECAST_WINDOW_DAYS=90

# ============================================================================
# EXPANSION CONFIGURATION
# ============================================================================

EXPANSION_MIN_HEALTH_SCORE=75
EXPANSION_MIN_USAGE_THRESHOLD=0.70
EXPANSION_MIN_TENURE_DAYS=60

UPSELL_OPPORTUNITY_THRESHOLD=0.65
CROSS_SELL_OPPORTUNITY_THRESHOLD=0.60

# ============================================================================
# SUPPORT CONFIGURATION
# ============================================================================

SUPPORT_FIRST_RESPONSE_SLA=15
SUPPORT_RESOLUTION_SLA_P1=240   # 4 hours
SUPPORT_RESOLUTION_SLA_P2=480   # 8 hours
SUPPORT_RESOLUTION_SLA_P3=1440  # 24 hours

SUPPORT_ESCALATION_NO_RESPONSE_HOURS=2
SUPPORT_ESCALATION_NO_RESOLUTION_DAYS=3

# ============================================================================
# MONITORING & OBSERVABILITY - Full production monitoring
# ============================================================================

ENABLE_MONITORING=true
ENABLE_AUDIT_LOGGING=true
ENABLE_TRACING=true

# Audit log settings - Long retention for compliance
AUDIT_LOG_RETENTION_DAYS=90
AUDIT_LOG_MAX_SIZE_MB=100
AUDIT_LOG_DIR=./config/audit_logs

# Sentry for error tracking (production DSN)
SENTRY_DSN=CHANGE_ME_sentry_production_dsn
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1  # Sample 10% of transactions
SENTRY_PROFILES_SAMPLE_RATE=0.1

# DataDog for metrics and APM
DATADOG_API_KEY=CHANGE_ME_datadog_production_key
DATADOG_APP_KEY=CHANGE_ME_datadog_app_key
DATADOG_SERVICE_NAME=customer-success-mcp
DATADOG_ENV=production

# Prometheus metrics endpoint
PROMETHEUS_METRICS_ENABLED=true
PROMETHEUS_METRICS_PORT=9090

# ============================================================================
# BACKUP & DISASTER RECOVERY
# ============================================================================

# Automated backups enabled
BACKUP_ENABLED=true
BACKUP_SCHEDULE_CRON=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=CHANGE_ME_s3_bucket_for_backups
BACKUP_S3_REGION=us-east-1

# Point-in-time recovery enabled
PITR_ENABLED=true
PITR_RETENTION_DAYS=7

# ============================================================================
# SECURITY HARDENING
# ============================================================================

# CORS Configuration
CORS_ENABLED=true
CORS_ALLOWED_ORIGINS=https://yourcompany.com,https://app.yourcompany.com
CORS_ALLOW_CREDENTIALS=true

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000  # 1 year

# Content Security Policy
CSP_ENABLED=true
CSP_DIRECTIVES=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'

# ============================================================================
# FEATURE FLAGS - Production configuration
# ============================================================================

FEATURE_CHURN_PREDICTION=true
FEATURE_HEALTH_SCORING=true
FEATURE_AUTOMATED_RETENTION=true
FEATURE_EXPANSION_SCORING=true
FEATURE_SENTIMENT_ANALYSIS=true
FEATURE_AUTO_TICKET_ROUTING=true
FEATURE_KNOWLEDGE_BASE_SYNC=true
FEATURE_EBR_AUTOMATION=true

# ============================================================================
# GDPR & COMPLIANCE
# ============================================================================

GDPR_COMPLIANCE_ENABLED=true
DATA_RETENTION_POLICY_DAYS=730  # 2 years
GDPR_CONTACT_EMAIL=privacy@yourcompany.com

# Data export settings
DATA_EXPORT_ENABLED=true
DATA_EXPORT_FORMAT=json,csv

# Right to be forgotten
DATA_DELETION_ENABLED=true
DATA_DELETION_VERIFICATION_REQUIRED=true

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Worker configuration
WORKER_PROCESSES=4
WORKER_THREADS_PER_PROCESS=10
WORKER_MAX_REQUESTS=10000
WORKER_MAX_REQUESTS_JITTER=1000

# Timeout configuration
REQUEST_TIMEOUT=30
DATABASE_QUERY_TIMEOUT=15
EXTERNAL_API_TIMEOUT=10

# Caching strategy
CACHE_STRATEGY=redis
CACHE_COMPRESSION_ENABLED=true

# ============================================================================
# NOTIFICATIONS & ALERTING
# ============================================================================

# Alert thresholds
ALERT_ERROR_RATE_THRESHOLD=0.01  # 1% error rate
ALERT_RESPONSE_TIME_P95_MS=2000  # 2 seconds
ALERT_DATABASE_CONNECTION_THRESHOLD=90  # 90% pool utilization

# Notification channels
ALERT_EMAIL=alerts@yourcompany.com
ALERT_SLACK_WEBHOOK=CHANGE_ME_slack_webhook_for_alerts
ALERT_PAGERDUTY_KEY=CHANGE_ME_pagerduty_integration_key

# ============================================================================
# NOTES FOR DEPLOYMENT
# ============================================================================

# 1. Replace ALL "CHANGE_ME" values with actual production credentials
# 2. Store this file securely - never commit to version control
# 3. Use AWS Secrets Manager or equivalent for sensitive values
# 4. Rotate all credentials every 90 days
# 5. Enable MFA for all administrative access
# 6. Run security audit before deployment: ./scripts/security_scan.sh
# 7. Test database backup and restore procedures
# 8. Verify all integrations in staging first
# 9. Set up monitoring alerts before going live
# 10. Document runbooks for incident response
